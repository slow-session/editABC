<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name=viewport content="width=device-width, initial-scale=1">

  <title>Edit ABC | editABC</title>
  
    <meta name="author" content="asjl@lpnz">
  
  
  <meta name="description" content="Simple ABC editor">
  
    <meta name="keywords" content="irish, traditional, music, jigs, reels, polkas, craic">
  

  <link href="http://localhost:4002/css/nouislider.css" media="screen" rel="stylesheet" type="text/css">
  <link href="http://localhost:4002/css/main.css" media="screen" rel="stylesheet" type="text/css">
  <link rel="canonical" href="http://localhost:4002/">
  <link href="http://localhost:4002/favicon.ico" rel="icon">
  <link rel="alternate" type="application/atom+xml" title="editABC" href="http://localhost:4002/atom.xml"/>
  <link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4002/images/apple-touch.jpg" />

  <!-- Colour should match $primary_color in _sass/_variables.scss -->
  <!-- See https://stackoverflow.com/questions/26960703/how-to-change-the-color-of-header-bar-and-address-bar-in-newest-chrome-version-o/26960753#26960753 -->
  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#282828">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#282828">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <script src="/js/abcplayer.js"></script>
<script src="/js/wssTools.js"></script>

<script src="/js/jquery-3.3.1.min.js"></script>

<!-- https://github.com/PencilCode/musical.js -->
<script src="/js/musical.min.js"></script>

<!-- https://github.com/paulrosen/abcjs -->
<script src="/js/abcjs_basic_5.12.0-min.js"></script>

<!-- https://refreshless.com/nouislider/ -->
<script src="/js/nouislider.min.js"></script>
<!-- https://refreshless.com/wnumb/ -->
<script src="/js/wNumb.min.js"></script>




</head>

  <body>
    <main class="wrap">

      <div class="row">
    <article class="post-content">
        <header class="page-header">
            <h1 class="page-title">Edit ABC</h1>
        </header>
        <p>If you’d like more information on the ABC format check out the
<a href="http://abcnotation.com/wiki/abc:standard:v2.2">ABC Notation</a>
guide.</p>

<div class="row">
    <!-- Draw the dots -->
    <div class="output">
        <div id="abcPaper" class="abcPaper"></div>
    </div>

    <!-- Controls for ABC player -->
    <div id="ABCplayer"></div>
</div>
<!-- Group the input and controls for ABC-->
<div class="row">
    <h3>Open an ABC file:</h3>
    <input type="file" id="files" class="filterButton" name="files[]" accept=".abc" />
    <output id="fileInfo"></output>
    <p />
</div>
<div class="row">
    <h3>Or paste your ABC here:</h3>
    <!-- Read the modified ABC and play if requested -->
    <textarea name="abc" id="textAreaABC" class="abcText" rows="13" spellcheck="false"></textarea>
    <!-- Show ABC errors -->
    <div id="warnings"></div>
</div>
<div class="row">
    <!-- Allow the user to save their ABC-->
    <h3>Don’t forget to Save ABC’ to save your work:</h3>
    <form>
        <span title="Save the ABC you've entered. Don't lose your work!">
            <input value="Save ABC" type="button" class="filterButton" onclick="wssTools.downloadABCFile(document.getElementById(&quot;textAreaABC&quot;).value)" />
        </span>
    </form>
    <p />
</div>

<script>
$(document).ready(function () {
    // Check for the various File API support.
    var fileInfo = document.getElementById('fileInfo');
    if (window.File && window.FileReader && window.FileList && window.Blob) {
        document.getElementById('files').addEventListener('change', handleABCFileSelect, false);
    } else {
        fileInfo.innerHTML = 'The File APIs are not fully supported in this browser.';
    }
    
    // Create the ABC player
    document.getElementById('ABCplayer').innerHTML = abcPlayer.createABCplayer('textAreaABC', '1', 'piano');  
    abcPlayer.createABCsliders("textAreaABC", '1');
    
 
});

function handleABCFileSelect(evt) {
    evt.stopPropagation();
    evt.preventDefault();

    var files = evt.target.files; // FileList object.

    // files is a FileList of File objects. List some properties.
    for (var i = 0, f; f = files[i]; i++) {
        var reader = new FileReader();

        reader.onload = function(e) {
            // Is ABC file valid?
            if ((abcPlayer.getABCheaderValue("X:", this.result) == '')
                || (abcPlayer.getABCheaderValue("T:", this.result) == '')
                || (abcPlayer.getABCheaderValue("K:", this.result) == '')) { fileInfo.innerHTML = "Invalid ABC file";
                return (1);
            }

            // Show the dots
            textAreaABC.value = this.result; 
            
            // Display the ABC in the textbox as dots
            let abc_editor = new window.ABCJS.Editor("textAreaABC", { paper_id: "abcPaper", warnings_id:"abcWarnings", render_options: {responsive: 'resize'}, indicate_changed: "true" });

            
            // stop tune currently playing if needed
            var playButton = document.getElementById("playABC1");
            if (typeof playButton !== 'undefined'
                && playButton.className == "stopButton") {
                abcPlayer.stopABCplayer();
                playButton.className = "";
                playButton.className = "playButton";
            }
        };
        reader.readAsText(f);
    }
}
</script>


    </article>

</div>



      </main>
  </body>
</html>
